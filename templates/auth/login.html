{% extends "base.html" %}

{% block title %}Entrar - Cidades Frias, Cora√ß√µes Quentes{% endblock %}

{% block main_class %}container mt-5{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card shadow-lg">
            <div class="card-header bg-primary text-white text-center">
                <h3 class="mb-0">
                    <i class="fas fa-sign-in-alt"></i>
                    Acessar Sistema
                </h3>
                <p class="mb-0">Escolha seu perfil para continuar</p>
            </div>
            
            <div class="card-body p-4">
                <!-- Gestor P√∫blico -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="card h-100 border-0 shadow-sm profile-card" data-profile="gestor">
                            <div class="card-body text-center p-4">
                                <div class="profile-icon mb-3">
                                    <i class="fas fa-user-tie fa-3x text-primary"></i>
                                </div>
                                <h5 class="card-title text-primary">Gestor P√∫blico</h5>
                                <p class="card-text text-muted">
                                    Acesso completo ao sistema com relat√≥rios detalhados, 
                                    an√°lises de criticidade e ferramentas de gest√£o urbana.
                                </p>
                                <ul class="list-unstyled text-start">
                                    <li><i class="fas fa-check text-success"></i> Mapa interativo completo</li>
                                    <li><i class="fas fa-check text-success"></i> Relat√≥rios PDF detalhados</li>
                                    <li><i class="fas fa-check text-success"></i> An√°lises de criticidade</li>
                                    <li><i class="fas fa-check text-success"></i> Sugest√µes de a√ß√µes</li>
                                </ul>
                                <button class="btn btn-primary btn-lg w-100" onclick="loginAsProfile('gestor')">
                                    <i class="fas fa-sign-in-alt"></i> Entrar como Gestor
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Civil -->
                <div class="row">
                    <div class="col-12">
                        <div class="card h-100 border-0 shadow-sm profile-card" data-profile="civil">
                            <div class="card-body text-center p-4">
                                <div class="profile-icon mb-3">
                                    <i class="fas fa-users fa-3x text-success"></i>
                                </div>
                                <h5 class="card-title text-success">Civil</h5>
                                <p class="card-text text-muted">
                                    Interface simplificada para identificar zonas que precisam 
                                    de ajuda e contribuir com a arboriza√ß√£o da cidade.
                                </p>
                                <ul class="list-unstyled text-start">
                                    <li><i class="fas fa-check text-success"></i> Mapa com zonas de calor</li>
                                    <li><i class="fas fa-check text-success"></i> Identifica√ß√£o de √°reas cr√≠ticas</li>
                                    <li><i class="fas fa-check text-success"></i> Bot√£o de ajuda simplificado</li>
                                    <li><i class="fas fa-check text-success"></i> Contato direto para a√ß√µes</li>
                                </ul>
                                <button class="btn btn-success btn-lg w-100" onclick="loginAsProfile('civil')">
                                    <i class="fas fa-hands-helping"></i> Entrar como Civil
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Demo Info -->
                <div class="alert alert-info mt-4">
                    <h6><i class="fas fa-info-circle"></i> Modo Demonstra√ß√£o</h6>
                    <p class="mb-0">
                        Este √© um sistema de demonstra√ß√£o. Escolha um perfil para explorar 
                        as diferentes interfaces e funcionalidades dispon√≠veis.
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
function loginAsProfile(profile) {
    console.log('üöÄ Tentando login como:', profile);
    
    // Mostra loading
    const button = event.target;
    const originalText = button.innerHTML;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Entrando...';
    button.disabled = true;
    
    // Cria form data para enviar ao Flask
    const formData = new FormData();
    formData.append('profile', profile);
    
    fetch('/auth/login', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        console.log('üì° Response status:', response.status);
        return response.json();
    })
    .then(data => {
        console.log('üìä Response data:', data);
        if (data.success) {
            console.log('‚úÖ Login bem-sucedido, redirecionando...');
            window.location.href = '/';
        } else {
            console.error('‚ùå Erro no login:', data.error);
            alert('Erro ao fazer login: ' + (data.error || 'Erro desconhecido'));
            // Restaura bot√£o
            button.innerHTML = originalText;
            button.disabled = false;
        }
    })
    .catch(error => {
        console.error('üí• Erro na requisi√ß√£o:', error);
        alert('Erro ao fazer login. Tente novamente.');
        // Restaura bot√£o
        button.innerHTML = originalText;
        button.disabled = false;
    });
}

// Adiciona efeito hover nos cards
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.profile-card').forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.transition = 'transform 0.3s ease';
        });
        
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
        });
    });
});
</script>
{% endblock %}